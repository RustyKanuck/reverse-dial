<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reverse Dial Method</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f4; }
    h1 { text-align: center; }
    .section {
      background: #fff; padding: 15px; margin-bottom: 20px;
      border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    input, select { width: 100%; padding: 5px; margin: 5px 0 12px 0; }
    .results { background: #eef; padding: 10px; font-weight: bold; border-radius: 5px; }
    canvas { border: 1px solid #ccc; margin-top: 10px; }
    .smiley { font-size: 1.6em; }
  </style>
</head>
<body>

<h1>Reverse Dial Method</h1>

<!-- DIMENSIONS -->
<div class="section">
  <h2>Dimensions</h2>
  <label>Dial span A (in):</label><input id="A" type="number" step="0.001">
  <label>B: Dial to front motor foot (in):</label><input id="B" type="number" step="0.001">
  <label>C: Dial to rear motor foot (in):</label><input id="C" type="number" step="0.001">
  <label>Machine RPM:</label><input id="rpm" type="number">
  <label>Coupling Diameter (in):</label><input id="coupling" type="number" step="0.01">
</div>

<!-- MOTOR DIAL -->
<div class="section">
  <h2>Motor-Mounted Dial (D1)</h2>
  <label>12 o'clock:</label><input id="m12" type="number" step="0.001">
  <label>3 o'clock:</label><input id="m3" type="number" step="0.001">
  <label>6 o'clock:</label><input id="m6" type="number" step="0.001">
  <label>9 o'clock:</label><input id="m9" type="number" step="0.001">
</div>

<!-- PUMP DIAL -->
<div class="section">
  <h2>Pump-Mounted Dial (D2)</h2>
  <label>12 o'clock:</label><input id="p12" type="number" step="0.001">
  <label>3 o'clock:</label><input id="p3" type="number" step="0.001">
  <label>6 o'clock:</label><input id="p6" type="number" step="0.001">
  <label>9 o'clock:</label><input id="p9" type="number" step="0.001">
</div>

<!-- THERMAL GROWTH -->
<div class="section">
  <h2>Thermal Growth Compensation</h2>
  <label><input id="tgEnable" type="checkbox"> Enable Thermal Compensation</label><br><br>

  <label>Motor height (in):</label><input id="motorH" type="number" step="0.01">
  <label>Motor Î”T (Â°F):</label><input id="motorT" type="number">
  <label>Motor material:</label>
  <select id="motorMat">
    <option>Cast Steel</option>
    <option>Cast Iron</option>
    <option>Stainless Steel 316</option>
  </select>

  <label>Pump height (in):</label><input id="pumpH" type="number" step="0.01">
  <label>Pump Î”T (Â°F):</label><input id="pumpT" type="number">
  <label>Pump material:</label>
  <select id="pumpMat">
    <option>Cast Steel</option>
    <option>Cast Iron</option>
    <option>Stainless Steel 316</option>
  </select>
</div>

<button onclick="calculate()" style="padding:10px 20px;">Calculate Alignment</button>

<div class="section results" id="results">
  <h3>Results:</h3>
  <p>Waiting for input...</p>
</div>

<!-- GRAPHS -->
<div class="section">
  <h3>Vertical Graph</h3><canvas id="vgraph" width="400" height="150"></canvas>
  <h3>Horizontal Graph</h3><canvas id="hgraph" width="400" height="150"></canvas>
</div>

<!-- REFERENCE IMAGE -->
<div class="section">
  <h2>Reverse Dial Reference Diagram</h2>
  <p>Click to enlarge:</p>
  <a href="reverse_indicator.png" target="_blank">
    <img src="reverse_indicator.png" style="max-width:100%;border:1px solid #ccc;">
  </a>
</div>

<script>
// quick util
function N(id){ return parseFloat(document.getElementById(id).value); }

function calculate() {
  const A = N("A"), B = N("B"), C = N("C");
  const coupling = N("coupling"), rpm = N("rpm");

  const m12=N("m12"), m3=N("m3"), m6=N("m6"), m9=N("m9");
  const p12=N("p12"), p3=N("p3"), p6=N("p6"), p9=N("p9");

  // VERTICAL
  const D1v = m6 - m12;
  const D2v = p6 - p12;

  let VO = D1v / 2;
  let VA = (D2v - D1v) / (2 * A);

  // MIRROR-READING AUTO-FIX (shafts are parallel)
  if (Math.abs(D1v + D2v) < 0.0005) {
    VA = 0; // parallel shafts, pure offset
  }

  let S1 = VO + VA * B;
  let S2 = VO + VA * C;

  // HORIZONTAL
  const D1h = m9 - m3;
  const D2h = p9 - p3;

  const HO = D1h / 2;
  let HA = (D2h - D1h) / (2 * A);

  if (Math.abs(D1h + D2h) < 0.0005) {
    HA = 0;
  }

  // THERMAL GROWTH
  let motorGrow=0, pumpGrow=0;
  if (document.getElementById("tgEnable").checked) {
    const coeff = {
      "Cast Steel": 6.6e-6,
      "Cast Iron": 5.5e-6,
      "Stainless Steel 316": 9.6e-6
    };
    motorGrow = coeff[document.getElementById("motorMat").value] * N("motorH") * N("motorT");
    pumpGrow  = coeff[document.getElementById("pumpMat").value]  * N("pumpH")  * N("pumpT");

    const diff = motorGrow - pumpGrow;
    S1 += diff;
    S2 += diff;
  }

  // TOLERANCES
  let voTol = coupling * 0.0005;
  let vaTol = coupling * 0.0001;
  let hoTol = coupling * 0.0005;
  let haTol = coupling * 0.0001;

  if (rpm < 1800){ voTol*=1.5; vaTol*=1.5; hoTol*=1.5; haTol*=1.5; }
  if (rpm > 3600){ voTol*=0.5; vaTol*=0.5; hoTol*=0.5; haTol*=0.5; }

  const ok =
    Math.abs(VO)<=voTol &&
    Math.abs(VA)<=vaTol &&
    Math.abs(HO)<=hoTol &&
    Math.abs(HA)<=haTol;

  const face = ok ? "ðŸ˜Š In tolerance" : "â˜¹ï¸ Out of tolerance";

  document.getElementById("results").innerHTML = `
    <p>Front foot shim (S1): ${S1.toFixed(4)} in</p>
    <p>Rear foot shim (S2): ${S2.toFixed(4)} in</p>
    <hr>
    <p>VO: ${VO.toFixed(4)} in</p>
    <p>VA: ${VA.toFixed(5)} in/in</p>
    <p>HO: ${HO.toFixed(4)} in</p>
    <p>HA: ${HA.toFixed(5)} in/in</p>
    <hr>
    <p>Thermal (motor): ${motorGrow.toFixed(4)} in</p>
    <p>Thermal (pump): ${pumpGrow.toFixed(4)} in</p>
    <hr>
    <p>VO â‰¤ ${voTol.toFixed(4)}</p>
    <p>VA â‰¤ ${vaTol.toFixed(5)}</p>
    <p>HO â‰¤ ${hoTol.toFixed(4)}</p>
    <p>HA â‰¤ ${haTol.toFixed(5)}</p>
    <p class="smiley">${face}</p>
  `;

  drawGraph("vgraph", VO);
  drawGraph("hgraph", HO);
}

function drawGraph(id, v){
  let c=document.getElementById(id), x=c.getContext("2d");
  x.clearRect(0,0,c.width,c.height);
  const cx=c.width/2, cy=c.height/2;
  x.beginPath();
  x.moveTo(cx-60, cy - v*1200);
  x.lineTo(cx, cy);
  x.lineTo(cx+60, cy + v*1200);
  x.strokeStyle="#000"; x.lineWidth=2; x.stroke();
}
</script>

</body>
</html>
