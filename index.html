<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reverse Dial Method</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
      color: #333;
    }
    h1 { text-align: center; }
    .section {
      background: #fff;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    input, select {
      width: 100%;
      padding: 5px;
      margin: 5px 0 12px 0;
      box-sizing: border-box;
    }
    .results {
      background: #eef;
      padding: 10px;
      font-weight: bold;
      border-radius: 5px;
    }
    canvas {
      border: 1px solid #ccc;
      margin-top: 10px;
    }
    .smiley { font-size: 1.6em; }
    .note { font-size: 0.9em; color: #555; }
  </style>
</head>
<body>

<h1>Reverse Dial Method</h1>

<!-- DIMENSIONS -->
<div class="section">
  <h2>Dimensions</h2>
  <h4>Mount both dials at 12 o'clock in the same plane and zero. Correct sag separately.</h4>
  <label>Dial span A (distance between dial contact points) [in]:</label>
  <input id="A" type="number" step="0.001">
  <label>B: Distance from driven-side dial to front motor foot [in]:</label>
  <input id="B" type="number" step="0.001">
  <label>C: Distance from driven-side dial to rear motor foot [in]:</label>
  <input id="C" type="number" step="0.001">
  <label>Machine RPM:</label>
  <input id="rpm" type="number">
  <label>Coupling diameter (in):</label>
  <input id="coupling" type="number" step="0.01">
</div>

<!-- MOTOR DIAL -->
<div class="section">
  <h2>Motor-Mounted Dial Readings (D1) â€“ reads driven</h2>
  <label>12 o'clock:</label><input id="m12" type="number" step="0.001">
  <label>3 o'clock:</label><input id="m3" type="number" step="0.001">
  <label>6 o'clock:</label><input id="m6" type="number" step="0.001">
  <label>9 o'clock:</label><input id="m9" type="number" step="0.001">
</div>

<!-- PUMP DIAL -->
<div class="section">
  <h2>Pump-Mounted Dial Readings (D2) â€“ reads driver</h2>
  <label>12 o'clock:</label><input id="p12" type="number" step="0.001">
  <label>3 o'clock:</label><input id="p3" type="number" step="0.001">
  <label>6 o'clock:</label><input id="p6" type="number" step="0.001">
  <label>9 o'clock:</label><input id="p9" type="number" step="0.001">
</div>

<!-- THERMAL GROWTH -->
<div class="section">
  <h2>Thermal Growth Compensation</h2>
  <label><input id="tgEnable" type="checkbox"> Enable Thermal Compensation</label><br><br>

  <label>Motor height (foot to shaft center) [in]:</label>
  <input id="motorH" type="number" step="0.01">
  <label>Motor temperature rise Î”T (Â°F):</label>
  <input id="motorT" type="number">
  <label>Motor material:</label>
  <select id="motorMat">
    <option>Cast Steel</option>
    <option>Cast Iron</option>
    <option>Stainless Steel 316</option>
  </select>

  <label>Pump height (foot to shaft center) [in]:</label>
  <input id="pumpH" type="number" step="0.01">
  <label>Pump temperature rise Î”T (Â°F):</label>
  <input id="pumpT" type="number">
  <label>Pump material:</label>
  <select id="pumpMat">
    <option>Cast Steel</option>
    <option>Cast Iron</option>
    <option>Stainless Steel 316</option>
  </select>
</div>

<div class="section">
  <button onclick="calculate()" style="padding:10px 20px;">Calculate Alignment</button>
</div>

<div class="section results" id="results">
  <h3>Results:</h3>
  <p>Waiting for input...</p>
</div>

<div class="section">
  <h3>Vertical Alignment Graph</h3>
  <canvas id="vgraph" width="400" height="150"></canvas>
  <h3>Horizontal Alignment Graph</h3>
  <canvas id="hgraph" width="400" height="150"></canvas>
</div>

<div class="section">
  <h2>Reference: Reverse Dial Diagram</h2>
  <p class="note">Click image to open full size.</p>
  <!-- Save your screenshot as reverse_indicator.png next to this HTML file -->
  <a href="reverse_indicator.png" target="_blank">
    <img src="reverse_indicator.png" alt="Reverse dial reference"
         style="max-width:100%;height:auto;border:1px solid #ccc;">
  </a>
</div>

<script>
function N(id){
  const v = parseFloat(document.getElementById(id).value);
  return isNaN(v) ? null : v;
}

function calculate(){
  const A = N("A"), B = N("B"), C = N("C");
  const rpm = N("rpm"), coupling = N("coupling");

  const m12=N("m12"), m3=N("m3"), m6=N("m6"), m9=N("m9");
  const p12=N("p12"), p3=N("p3"), p6=N("p6"), p9=N("p9");

  if ([A,B,C,m12,m3,m6,m9,p12,p3,p6,p9].some(v => v === null)) {
    document.getElementById("results").innerHTML =
      "<h3>Results:</h3><p>Please fill in all required fields.</p>";
    return;
  }

  // ---------------- VERTICAL (12â€“6) ----------------
  // D1, D2 as per book: total reading from 12 â†’ 6 on each dial
  const D1 = m6 - m12;
  const D2 = p6 - p12;
  const Davg = (D1 + D2) / 2.0;

  // EXACT textbook shim formulas:
  // S1 = (B + A) * ((D1 + D2)/2) - (D1/2)
  // S2 = (C + A) * ((D1 + D2)/2) - (D1/2)
  let S1 = (B + A) * Davg - (D1 / 2.0);
  let S2 = (C + A) * Davg - (D1 / 2.0);

  // From S1 & S2, derive VO and VA (linear line through feet):
  // S(x) = VO + VA * x
  // S(B) = S1, S(C) = S2
  let VA, VO;
  if (C !== B){
    VA = (S2 - S1) / (C - B);    // in/in
    VO = S1 - VA * B;            // offset at dial plane (x = 0)
  } else {
    VA = 0;
    VO = S1;
  }

  // ---------------- HORIZONTAL (3â€“9) ----------------
  const D1h = m9 - m3;
  const D2h = p9 - p3;

  const HO = D1h / 2.0;
  const HA = (D2h - D1h) / (2.0 * A);

  // ---------------- THERMAL GROWTH ----------------
  let motorGrow = 0, pumpGrow = 0;
  if (document.getElementById("tgEnable").checked) {
    const coeff = {
      "Cast Steel": 6.6e-6,
      "Cast Iron": 5.5e-6,
      "Stainless Steel 316": 9.6e-6
    };
    const motorH = N("motorH"), motorT = N("motorT");
    const pumpH  = N("pumpH"),  pumpT  = N("pumpT");

    if ([motorH,motorT,pumpH,pumpT].every(v => v !== null)) {
      motorGrow = coeff[document.getElementById("motorMat").value] * motorH * motorT;
      pumpGrow  = coeff[document.getElementById("pumpMat").value]  * pumpH  * pumpT;

      const diff = motorGrow - pumpGrow;
      S1 += diff;
      S2 += diff;
    }
  }

  // ---------------- TOLERANCES (rough) ----------------
  let voTol = coupling * 0.0005;
  let vaTol = coupling * 0.0001;
  let hoTol = coupling * 0.0005;
  let haTol = coupling * 0.0001;

  if (rpm !== null) {
    if (rpm < 1800) { voTol*=1.5; vaTol*=1.5; hoTol*=1.5; haTol*=1.5; }
    else if (rpm > 3600) { voTol*=0.5; vaTol*=0.5; hoTol*=0.5; haTol*=0.5; }
  }

  const within =
    Math.abs(VO) <= voTol &&
    Math.abs(VA) <= vaTol &&
    Math.abs(HO) <= hoTol &&
    Math.abs(HA) <= haTol;

  const face = within ? "ðŸ˜Š In tolerance" : "â˜¹ï¸ Out of tolerance";

  document.getElementById("results").innerHTML = `
    <p>Positive = add shims, negative = remove shims.</p>
    <p>Front (inboard) foot shim S1: ${S1.toFixed(4)} in</p>
    <p>Rear (outboard) foot shim S2: ${S2.toFixed(4)} in</p>
    <hr/>
    <p>Raw vertical readings: D1 = ${D1.toFixed(4)} in, D2 = ${D2.toFixed(4)} in</p>
    <p>Vertical offset VO (at dial plane): ${VO.toFixed(4)} in</p>
    <p>Vertical angularity VA: ${VA.toFixed(5)} in/in</p>
    <p>Horizontal offset HO: ${HO.toFixed(4)} in</p>
    <p>Horizontal angularity HA: ${HA.toFixed(5)} in/in</p>
    <hr/>
    <p>Thermal growth (motor): ${motorGrow.toFixed(4)} in</p>
    <p>Thermal growth (pump): ${pumpGrow.toFixed(4)} in</p>
    <hr/>
    <p>VO â‰¤ ${voTol.toFixed(4)}"</p>
    <p>VA â‰¤ ${vaTol.toFixed(5)}"/in</p>
    <p>HO â‰¤ ${hoTol.toFixed(4)}"</p>
    <p>HA â‰¤ ${haTol.toFixed(5)}"/in</p>
    <p class="smiley">${face}</p>
  `;

  drawGraph("vgraph", VO, "Vertical");
  drawGraph("hgraph", HO, "Horizontal");
}

function drawGraph(id, value, label){
  const c = document.getElementById(id);
  const ctx = c.getContext("2d");
  ctx.clearRect(0,0,c.width,c.height);
  const cx = c.width/2, cy = c.height/2;
  ctx.beginPath();
  ctx.moveTo(cx-60, cy - value*1200);
  ctx.lineTo(cx, cy);
  ctx.lineTo(cx+60, cy + value*1200);
  ctx.strokeStyle = "#000";
  ctx.lineWidth = 2;
  ctx.stroke();
  ctx.font = "12px Arial";
  ctx.fillText(label, 10, 15);
}
</script>

</body>
</html>
