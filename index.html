<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reverse Dial Method Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
      color: #333;
    }
    h1 { text-align: center; }
    h2 { margin-top: 0; }
    label {
      font-weight: bold;
      display: block;
      margin-top: 5px;
    }
    input, select {
      width: 100%;
      padding: 5px;
      margin: 5px 0 10px 0;
      box-sizing: border-box;
    }
    .section {
      background: #ffffff;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .results {
      background: #eef;
      padding: 10px;
      font-weight: bold;
      border-radius: 5px;
    }
    canvas {
      margin-top: 10px;
      border: 1px solid #ccc;
    }
    .smiley {
      font-size: 1.5em;
    }
    button {
      padding: 8px 16px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
    }
    button:hover { opacity: 0.9; }
  </style>
</head>
<body>
  <h1>Reverse Dial Method</h1>

  <div class="section">
    <h2>Dimensions</h2>
    <h4>
      Mount both dials in the same plane at the 12 o'clock position and zero.
      Correct for dial sag separately (check at 6 o'clock and preset zero to remove sag).
    </h4>
    <label>Dial span A (distance between dial contact points) [in]:</label>
    <input id="distA" type="number" step="0.001" />

    <label>B: Distance from driven-side dial to <strong>front</strong> motor foot [in]:</label>
    <input id="distB" type="number" step="0.001" />

    <label>C: Distance from driven-side dial to <strong>rear</strong> motor foot [in]:</label>
    <input id="distC" type="number" step="0.001" />

    <label>Machine RPM:</label>
    <input id="rpm" type="number" />

    <label>Coupling Diameter (in):</label>
    <input id="couplingDia" type="number" step="0.01" />
  </div>

  <div class="section">
    <h2>Motor-Mounted Dial Readings (D1) â€“ Reads off Driven</h2>
    <label>12 o'clock:</label><input id="m12" type="number" step="0.001" />
    <label>3 o'clock:</label><input id="m3" type="number" step="0.001" />
    <label>6 o'clock:</label><input id="m6" type="number" step="0.001" />
    <label>9 o'clock:</label><input id="m9" type="number" step="0.001" />
  </div>

  <div class="section">
    <h2>Pump-Mounted Dial Readings (D2) â€“ Reads off Driver</h2>
    <label>12 o'clock:</label><input id="p12" type="number" step="0.001" />
    <label>3 o'clock:</label><input id="p3" type="number" step="0.001" />
    <label>6 o'clock:</label><input id="p6" type="number" step="0.001" />
    <label>9 o'clock:</label><input id="p9" type="number" step="0.001" />
  </div>

  <div class="section">
    <h2>Thermal Growth Compensation</h2>
    <label><input id="enableThermal" type="checkbox" /> Enable Thermal Growth Compensation</label><br/><br/>

    <label>Motor height from bottom of foot to shaft center (in):</label>
    <input id="motorHeight" type="number" step="0.01" />
    <label>Motor temperature rise (Â°F):</label>
    <input id="motorTempRise" type="number" />
    <label>Motor material:</label>
    <select id="motorMaterial">
      <option>Cast Steel</option>
      <option>Cast Iron</option>
      <option>Stainless Steel 316</option>
    </select>

    <label>Pump height from bottom of foot to shaft center (in):</label>
    <input id="pumpHeight" type="number" step="0.01" />
    <label>Pump temperature rise (Â°F):</label>
    <input id="pumpTempRise" type="number" />
    <label>Pump material:</label>
    <select id="pumpMaterial">
      <option>Cast Steel</option>
      <option>Cast Iron</option>
      <option>Stainless Steel 316</option>
    </select>
  </div>

  <div class="section">
    <button onclick="calculateAlignment()">Calculate Alignment</button>
  </div>

  <div class="section results" id="results">
    <h3>Results:</h3>
    <p>Waiting for input...</p>
  </div>

  <div class="section">
    <h3>Vertical Alignment Graph</h3>
    <canvas id="vertGraph" width="400" height="150"></canvas>

    <h3>Horizontal Alignment Graph</h3>
    <canvas id="horizGraph" width="400" height="150"></canvas>
  </div>

  <div class="section">
    <h2>Stand-alone Horizontal Correction Instructions</h2>
    <h4>*These are separate readings taken from an initial horizontal sweep.</h4>
    <p>To check and correct horizontal alignment:</p>
    <ol>
      <li>Zero both dials at the 3 o'clock position.</li>
      <li>Rotate to 9 o'clock and record the readings.</li>
      <li>Halve the Total Indicator Reading (TIR) at 9 o'clock to determine misalignment.</li>
      <li>Use jacking bolts to move the motor feet as needed. Front and rear may need opposite moves.</li>
    </ol>
    <p id="bottomHorizontalInstructions"><em>Instructions will appear after calculation.</em></p>
  </div>

  <div class="section">
    <h2>Quick Horizontal Live Move</h2>
    <h4>Zero both dials at 3 o'clock, then record readings at both 3 and 9 for motor and pump.</h4>
    <label>Motor dial 3 o'clock reading:</label><input id="qc3_m" type="number" step="0.001" />
    <label>Pump dial 3 o'clock reading:</label><input id="qc3_p" type="number" step="0.001" />
    <label>Motor dial 9 o'clock reading:</label><input id="qc9_m" type="number" step="0.001" />
    <label>Pump dial 9 o'clock reading:</label><input id="qc9_p" type="number" step="0.001" />
    <button onclick="calculateQuickCheck()">Compute Quick Check</button>
    <div class="results" id="quickResults"><p>Enter readings...</p></div>
  </div>

  <div class="section">
    <h2>Reference: Reverse Dial Setup Diagram</h2>
    <p>If you forget where A, B, C, D1, and D2 are measured from, click the image to view it full size.</p>
    <a href="/mnt/data/reverse indicator.png" target="_blank">
      <img src="/mnt/data/reverse indicator.png"
           alt="Reverse dial reference diagram"
           style="max-width:100%;height:auto;border:1px solid #ccc;">
    </a>
  </div>

  <script>
    function getNumber(id) {
      const v = parseFloat(document.getElementById(id).value);
      return isNaN(v) ? null : v;
    }

    function calculateAlignment() {
      // Geometry
      const A = getNumber("distA");
      const B = getNumber("distB");
      const C = getNumber("distC");
      const rpm = getNumber("rpm");
      const coupling = getNumber("couplingDia");

      // Dial readings
      const m12 = getNumber("m12");
      const m3  = getNumber("m3");
      const m6  = getNumber("m6");
      const m9  = getNumber("m9");

      const p12 = getNumber("p12");
      const p3  = getNumber("p3");
      const p6  = getNumber("p6");
      const p9  = getNumber("p9");

      // Basic validation
      const required = [A,B,C,rpm,coupling,m12,m3,m6,m9,p12,p3,p6,p9];
      if (required.some(v => v === null)) {
        document.getElementById("results").innerHTML =
          "<h3>Results:</h3><p>Please fill in all dimension and dial fields.</p>";
        return;
      }

      // ===== VERTICAL REVERSE DIAL (12â€“6) =====
      // Raw dial readings from 12 â†’ 6
      const D1v = m6 - m12;   // motor-mounted dial change 12â†’6
      const D2v = p6 - p12;   // pump-mounted dial change 12â†’6

      // Vertical offset & angularity (classic reverse-dial geometry)
      const VO = D1v / 2.0;                     // offset at driven-side dial
      const VA = (D2v - D1v) / (2.0 * A);       // angularity in/in

      // Shim moves at motor feet
      let S1 = VO + VA * B;   // front (inboard) foot
      let S2 = VO + VA * C;   // rear (outboard) foot

      // ===== HORIZONTAL REVERSE DIAL (3â€“9) =====
      const D1h = m9 - m3;    // motor-mounted 3â†’9
      const D2h = p9 - p3;    // pump-mounted 3â†’9

      const HO = D1h / 2.0;                     // offset at driven-side dial
      const HA = (D2h - D1h) / (2.0 * A);       // angularity in/in

      // ===== THERMAL GROWTH =====
      const enableThermal = document.getElementById("enableThermal").checked;
      const motorHeight = getNumber("motorHeight");
      const motorTemp   = getNumber("motorTempRise");
      const pumpHeight  = getNumber("pumpHeight");
      const pumpTemp    = getNumber("pumpTempRise");

      const coeffs = {
        "Cast Steel": 6.6e-6,
        "Cast Iron": 5.5e-6,
        "Stainless Steel 316": 9.6e-6
      };

      let motorGrowth = 0;
      let pumpGrowth  = 0;

      if (enableThermal &&
          motorHeight !== null && motorTemp !== null &&
          pumpHeight !== null && pumpTemp !== null) {

        const motorMat = document.getElementById("motorMaterial").value;
        const pumpMat  = document.getElementById("pumpMaterial").value;

        motorGrowth = coeffs[motorMat] * motorTemp * motorHeight;
        pumpGrowth  = coeffs[pumpMat]  * pumpTemp  * pumpHeight;

        const thermalDiff = motorGrowth - pumpGrowth;
        S1 += thermalDiff;
        S2 += thermalDiff;
      }

      // ===== TOLERANCES (simple approximate scheme) =====
      let vo_tol_val = coupling * 0.0005;
      let va_tol_val = coupling * 0.0001;
      let ho_tol_val = coupling * 0.0005;
      let ha_tol_val = coupling * 0.0001;

      if (rpm < 1800) {
        vo_tol_val *= 1.5;
        va_tol_val *= 1.5;
        ho_tol_val *= 1.5;
        ha_tol_val *= 1.5;
      } else if (rpm > 3600) {
        vo_tol_val *= 0.5;
        va_tol_val *= 0.5;
        ho_tol_val *= 0.5;
        ha_tol_val *= 0.5;
      }

      const withinTol =
        Math.abs(VO) <= vo_tol_val &&
        Math.abs(VA) <= va_tol_val &&
        Math.abs(HO) <= ho_tol_val &&
        Math.abs(HA) <= ha_tol_val;

      const face = withinTol ? "ðŸ˜Š In tolerance" : "â˜¹ï¸ Out of tolerance";

      const resultsHTML = `
        <p>Positive values mean <strong>add</strong> shims, negative values mean <strong>remove</strong> shims.</p>
        <p>Front (inboard) foot shim S1: ${S1.toFixed(4)} in</p>
        <p>Rear (outboard) foot shim S2: ${S2.toFixed(4)} in</p>
        <hr/>
        <p>Vertical offset VO (at driven dial): ${VO.toFixed(4)} in</p>
        <p>Vertical angularity VA: ${VA.toFixed(5)} in/in</p>
        <p>Horizontal offset HO (at driven dial): ${HO.toFixed(4)} in</p>
        <p>Horizontal angularity HA: ${HA.toFixed(5)} in/in</p>
        <hr/>
        <p>Thermal growth (motor): ${motorGrowth.toFixed(4)} in</p>
        <p>Thermal growth (pump): ${pumpGrowth.toFixed(4)} in</p>
        <hr/>
        <p><strong>Tolerance thresholds (coupling Ã¸ ${coupling}" & RPM ${rpm}):</strong></p>
        <p>VO â‰¤ ${vo_tol_val.toFixed(4)}"</p>
        <p>VA â‰¤ ${va_tol_val.toFixed(5)}"/in</p>
        <p>HO â‰¤ ${ho_tol_val.toFixed(4)}"</p>
        <p>HA â‰¤ ${ha_tol_val.toFixed(5)}"/in</p>
        <p class="smiley">${face}</p>
      `;

      document.getElementById("results").innerHTML = `<h3>Results:</h3>${resultsHTML}`;

      // Simple bottom horizontal instruction using HO as offset
      document.getElementById("bottomHorizontalInstructions").innerHTML = `
        <p>Rear motor foot: move ${Math.abs(HO).toFixed(4)} in ${HO > 0 ? "towards 3 o'clock" : "towards 9 o'clock"}.</p>
        <p>Front motor foot: move ${Math.abs(HO).toFixed(4)} in ${HO > 0 ? "towards 9 o'clock" : "towards 3 o'clock"}.</p>
      `;

      drawGraph("vertGraph", VO, "Vertical");
      drawGraph("horizGraph", HO, "Horizontal");
    }

    function calculateQuickCheck() {
      const qc3m = getNumber("qc3_m");
      const qc3p = getNumber("qc3_p");
      const qc9m = getNumber("qc9_m");
      const qc9p = getNumber("qc9_p");
      const span = getNumber("distA");

      if ([qc3m,qc3p,qc9m,qc9p,span].some(v => v === null)) {
        document.getElementById("quickResults").innerHTML =
          "<p>Please fill in all quick check and span fields.</p>";
        return;
      }

      const dm = qc9m - qc3m;
      const dp = qc9p - qc3p;
      const tir = dm - dp;
      const offset = tir / 2.0;
      const angular = offset / span;

      const dirRear = offset > 0 ? "towards 3 o'clock" : "towards 9 o'clock";
      const dirFront = offset > 0 ? "towards 9 o'clock" : "towards 3 o'clock";

      const html = `
        <p>Offset (half TIR): ${Math.abs(offset).toFixed(4)} in</p>
        <p>Angular misalignment: ${angular.toFixed(5)} in/in</p>
        <p>Rear motor foot: move ${Math.abs(offset).toFixed(4)} in ${dirRear}.</p>
        <p>Front motor foot: move ${Math.abs(offset).toFixed(4)} in ${dirFront}.</p>
      `;
      document.getElementById("quickResults").innerHTML = html;
    }

    function drawGraph(id, value, label) {
      const canvas = document.getElementById(id);
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;

      ctx.beginPath();
      ctx.moveTo(centerX - 60, centerY - value * 1000);
      ctx.lineTo(centerX, centerY);
      ctx.lineTo(centerX + 60, centerY + value * 1000);
      ctx.strokeStyle = "#000000";
      ctx.lineWidth = 2;
      ctx.stroke();

      ctx.font = "12px Arial";
      ctx.fillText(`${label} Alignment`, 10, 15);
    }
  </script>
</body>
</html>
